---
version: 1

project:
  name: project1
  description: this is a test project

settings:
  logging:
    level: INFO
    delay_workers_by_global_step: 10
    run_config:
      save_summary_steps: 100

declarations:
  cnn:
    kernels: [64, 32]
    size: [2, 2]
    strides: [1, 1]

model:
  classifier:
    loss:
      MeanSquaredError:
    optimizer:
      Adam:
    graph:
      input_layers: images
      layers:
        - for:
            len: "{{ cnn.kernels|length }}"
            do:
              - Conv2D:
                  filters: "{{ cnn.kernels[index] }}"
                  kernel_size: "{{ cnn.size }}"
                  strides: "{{ cnn.strides }}"
                  activation: relu
                  tags: tag1
                  is_output: true
        - if:
            cond: 1 == 1
            do:
              MaxPooling2D:
                kernels: 12
                is_output: true

        - if:
            cond: 1 == "{{ cnn.kernels[1] }}"
            do:
              MaxPooling2D:
                kernels: 12
                is_output: true
            else_do:
              for:
                len: "{{ cnn.kernels|length }}"
                do:
                  - Conv2D:
                      filters: "{{ cnn.kernels[index] }}"
                      kernel_size: "{{ cnn.size }}"
                      strides: "{{ cnn.strides }}"
                      activation: relu
                      tags: tag2
                      is_output: true

        - Flatten:
            inbound_nodes: ["{{ tags.tag1[1] }}"]
        - Dense:
            units: 10
            activation: softmax
        
train:
  train_steps: 100
  data_pipeline:
    TFRecordImagePipeline:
      batch_size: 64
      num_epochs: 1
      shuffle: true
      dynamic_pad: false
      data_files: ["../data/mnist/mnist_train.tfrecord"]
      meta_data_file: "../data/mnist/meta_data.json"

eval:
  eval_every_n_steps: 10
  data_pipeline:
    TFRecordImagePipeline:
      batch_size: 32
      num_epochs: 1
      shuffle: False
      data_files: ["../data/mnist/mnist_train.tfrecord"]
      meta_data_file: "../data/mnist/meta_data.json"
...
